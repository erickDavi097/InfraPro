<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Configurações de Perfil</title>
    <link rel="stylesheet" href="./css/configuracoes.css">
</head>
<body>
    <h1>Configurações de Perfil</h1>

    <section id="config-nome">
        <h2>Alterar Nome</h2>
        <input type="text" id="input-nome" placeholder="Novo nome">
        <button id="btn-salvar-nome">Salvar Nome</button>
    </section>

    <section id="config-biografia">
        <h2>Alterar Biografia</h2>
        <textarea id="input-biografia" rows="4" cols="50" placeholder="Sua biografia..."></textarea>
        <button id="btn-salvar-biografia">Salvar Biografia</button>
    </section>

    <section id="config-senha">
        <h2>Alterar Senha</h2>
        <input type="password" id="input-senha-atual" placeholder="Senha atual">
        <input type="password" id="input-senha-nova" placeholder="Nova senha">
        <button id="btn-salvar-senha">Alterar Senha</button>
    </section>

    <script>
        const userId = sessionStorage.ID_USUARIO;

document.getElementById('btn-salvar-nome').addEventListener('click', async () => {
    const novoNome = document.getElementById('input-nome').value.trim();
    if (!novoNome) return alert('O nome não pode ficar vazio.');

    const res = await fetch(`/usuario/nome/${userId}`, {
        method: 'PUT',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({ nome: novoNome })
    });

    if (res.ok) {
        alert('Nome atualizado com sucesso!');
        sessionStorage.NOME_USUARIO = novoNome;
    } else {
        alert('Erro ao atualizar nome.');
    }
});

document.getElementById('btn-salvar-biografia').addEventListener('click', async () => {
    const novaBio = document.getElementById('input-biografia').value.trim();

    const res = await fetch(`/usuario/biografia/${userId}`, {
        method: 'PUT',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({ biografia: novaBio })
    });

    if (res.ok) {
        alert('Biografia atualizada com sucesso!');
    } else {
        alert('Erro ao atualizar biografia.');
    }
});

document.getElementById('btn-salvar-senha').addEventListener('click', async () => {
  const senhaAtual = document.getElementById('input-senha-atual').value;
  const novaSenha = document.getElementById('input-senha-nova').value;

  if (!senhaAtual || !novaSenha) return alert('Preencha ambos os campos de senha.');

  try {
    const res = await fetch(`/usuario/senha/${userId}`, {
      method: 'PUT',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ senhaAtual, novaSenha })
    });

    if (!res.ok) {
      const errorData = await res.json();
      alert(errorData.erro || 'Erro ao atualizar senha');
      return;
    }

    alert('Senha atualizada com sucesso!');
  } catch (err) {
    alert('Erro na comunicação com o servidor.');
    console.error(err);
  }
});


    </script>
</body>
</html>
