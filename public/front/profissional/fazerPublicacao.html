<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8" />
    <title>Nova Publicação</title>
    <link rel="stylesheet" href="../../css/fazerPublicacao.css" />
</head>

<body>
    <div class="container">
        <h1>Nova Publicação</h1>
        <form id="formPublicacao" enctype="multipart/form-data">
            <label for="titulo">Título:</label>
            <input type="text" id="titulo" name="titulo" required />

            <label for="conteudo">Descrição:</label>
            <textarea id="conteudo" name="conteudo" rows="5" required></textarea>

            <label for="fkCategoria">Categoria:</label>
            <select id="fkCategoria" name="fkCategoria" required>
                <option value="">Carregando categorias...</option>
            </select>


            <label for="preco">Preço:</label>
            <input type="number" step="0.01" min="0" id="preco" name="preco" required />

            <label for="imagem">Imagem:</label>
            <input type="file" id="imagem" name="foto" accept="image/*" required />

            <button type="submit">Publicar</button>
        </form>
    </div>

    <script>
        const form = document.getElementById('formPublicacao');

        form.addEventListener('submit', function (e) {
            e.preventDefault();

            const formData = new FormData(form);
            const idUsuario = sessionStorage.ID_USUARIO;

            formData.append('fkUsuario', idUsuario);

            fetch('/publicacoes', {
                method: 'POST',
                body: formData
            })
                .then(response => {
                    if (response.ok) {
                        alert('Publicação feita com sucesso!');
                        form.reset();
                    } else {
                        alert('Erro ao publicar.');
                    }
                })
                .catch(error => {
                    alert('Erro de conexão.');
                    console.error(error);
                });
        });
        const selectCategoria = document.getElementById('fkCategoria');

        fetch('/categoria')
            .then(res => res.json())
            .then(categorias => {
                // limpa as opções atuais
                selectCategoria.innerHTML = '<option value="">Selecione uma categoria</option>';

                categorias.forEach(cat => {
                    const option = document.createElement('option');
                    option.value = cat.id;
                    option.textContent = cat.nome;
                    selectCategoria.appendChild(option);
                });
            })
            .catch(() => {
                selectCategoria.innerHTML = '<option value="">Erro ao carregar categorias</option>';
            });


    </script>
</body>

</html>